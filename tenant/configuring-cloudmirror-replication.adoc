---
permalink: tenant/configuring-cloudmirror-replication.html 
sidebar: sidebar 
keywords: how to configure CloudMirror replication, replication xml 
summary: CloudMirror レプリケーションサービスは、 3 つの StorageGRID プラットフォームサービスのいずれかです。CloudMirror レプリケーションを使用すると、外部の S3 バケットにオブジェクトを自動的にレプリケートできます。 
---
= CloudMirror レプリケーションを設定します
:icons: font
:imagesdir: ../media/


[role="lead"]
。 xref:understanding-cloudmirror-replication-service.adoc[CloudMirror レプリケーションサービス] は、 3 つの StorageGRID プラットフォームサービスのうちの 1 つです。CloudMirror レプリケーションを使用すると、外部の S3 バケットにオブジェクトを自動的にレプリケートできます。

.必要なもの
* テナントアカウントのプラットフォームサービスが StorageGRID 管理者によって有効化されている必要があります。
* レプリケーションのソースとして機能するバケットを作成しておく必要があります。
* CloudMirror レプリケーションのデスティネーションとして使用するエンドポイントを用意しておく必要があります。また、その URN が必要です。
* テナントアカウント内のすべての S3 バケットの設定を管理できるように、 Manage All Buckets 権限または Root Access 権限を持つユーザグループに属している必要があります。これらの権限は、 Tenant Manager を使用してバケットを設定する際にグループポリシーまたはバケットポリシーの権限設定よりも優先されます。


CloudMirror レプリケーションでは、ソースバケットからエンドポイントで指定されたデスティネーションバケットにオブジェクトがコピーされます。バケットの CloudMirror レプリケーションを有効にするには、有効なバケットレプリケーション設定 XML を作成して適用する必要があります。レプリケーション設定 XML では、各デスティネーションとして S3 バケットエンドポイントの URN を使用する必要があります。


NOTE: S3 オブジェクトロックが有効なソースバケットまたはデスティネーションバケットでは、レプリケーションはサポートされません。

バケットレプリケーションとその設定方法の一般的な情報については、 Amazon Simple Storage Service （ S3 ）のドキュメントでクロスリージョンレプリケーション（ CRR ）に関する説明を参照してください。StorageGRID で S3 バケットのレプリケーション設定 API を実装する方法については、を参照してください xref:../s3/index.adoc[S3 クライアントアプリケーションを実装するための手順]。

オブジェクトを含むバケットで CloudMirror レプリケーションを有効にすると、バケットに追加された新しいオブジェクトがレプリケートされますが、バケット内の既存のオブジェクトはレプリケートされません。レプリケーションをトリガーするには、既存のオブジェクトを更新する必要があります。

レプリケーション設定 XML でストレージクラスを指定した場合は、デスティネーション S3 エンドポイントに対して処理を実行する際に StorageGRID でそのクラスが使用されます。指定したストレージクラスは、デスティネーションエンドポイントでもサポートされている必要があります。デスティネーションシステムのベンダーからの推奨事項がある場合は、それに準拠してください。

.手順
. ソースバケットのレプリケーションを有効にします。
+
S3 レプリケーション API で指定されているように、レプリケーションを有効にするために必要なレプリケーション設定 XML をテキストエディタで作成します。XML を設定する場合は、次の点に

+
** StorageGRID では、 V1 のレプリケーション設定のみがサポートされます。つまり、 StorageGRID では「 Filter 」要素をルールに使用することはサポートされておらず、 V1 の規則に従ってオブジェクトバージョンが削除されます。詳細については、レプリケーション設定に関する Amazon のドキュメントを参照してください。
** デスティネーションとして S3 バケットエンドポイントの URN を使用してください。
** 必要に応じて '<StorageClass>' 要素を追加し ' 次のいずれかを指定します
+
*** 'standard' ：デフォルトのストレージ・クラスオブジェクトのアップロード時にストレージクラスを指定しなかった場合は 'standard' ストレージ・クラスが使用されます
*** 'standard_IA`: ( 標準 - 低頻度アクセス ) このストレージクラスは、アクセス頻度は低いが、必要に応じて高速アクセスが必要なデータに使用します。
*** reduced_redundancy</1> ：非クリティカルで再現性のあるデータを格納する場合に 'standard' ストレージ・クラスよりも低い冗長性で保存できるようにするには ' このストレージ・クラスを使用します


** 設定 XML で「 Role 」を指定すると、無視されます。この値は StorageGRID では使用されません。


+
[listing]
----
<ReplicationConfiguration>
    <Role></Role>
    <Rule>
        <Status>Enabled</Status>
        <Prefix>2020</Prefix>
        <Destination>
           <Bucket>urn:sgws:s3:::2017-records</Bucket>
           <StorageClass>STANDARD</StorageClass>
         </Destination>
     </Rule>
</ReplicationConfiguration>
----
. Tenant Manager で、 * Storage （ S3 ） * > * Buckets * を選択します。
. ソースバケットの名前を選択します。
+
バケットの詳細ページが表示されます。

. プラットフォームサービス * > * レプリケーション * を選択します。
. [ レプリケーションを有効にする *] チェックボックスをオンにします。
. レプリケーション設定 XML をテキストボックスに貼り付け、 * 変更を保存 * を選択します。
+
image::../media/tenant_bucket_replication_configuration.png[レプリケーションの設定ダイアログボックスのスクリーンショット]

+

NOTE: StorageGRID 管理者がグリッドマネージャまたはグリッド管理 API を使用して各テナントアカウントのプラットフォームサービスを有効にしておく必要があります。設定 XML の保存時にエラーが発生した場合は、 StorageGRID 管理者にお問い合わせください。

. レプリケーションが正しく設定されていることを確認します。
+
.. レプリケーション設定で指定されたレプリケーションの要件を満たすオブジェクトをソースバケットに追加します。
+
前述の例では、プレフィックス「 2020 」に一致するオブジェクトがレプリケートされます。

.. オブジェクトがデスティネーションバケットにレプリケートされたことを確認します。
+
サイズの小さいオブジェクトについては、レプリケーションの所要時間が短くなります。





xref:../s3/index.adoc[S3 を使用する]

xref:creating-platform-services-endpoint.adoc[プラットフォームサービスエンドポイントを作成します]

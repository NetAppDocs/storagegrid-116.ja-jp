---
permalink: primer/delete-data-flow.html 
sidebar: sidebar 
keywords: object, delete, deletion, object lock, bucket lifecycle, expiration, ilm, placement instruction 
summary: クライアントが削除処理を実行するか、またはオブジェクトの有効期間が終了して自動削除がトリガーされると、すべてのオブジェクトコピーが StorageGRID システムから削除されます。オブジェクト削除のデータフローが定義されています。 
---
= データフローを削除します
:icons: font
:imagesdir: ../media/


[role="lead"]
クライアントが削除処理を実行するか、またはオブジェクトの有効期間が終了して自動削除がトリガーされると、 StorageGRID システムからすべてのオブジェクトコピーが削除されます。オブジェクト削除のデータフローが定義されています。



== 削除階層

StorageGRID では、オブジェクトを保持するか削除するかを制御する方法がいくつかあります。オブジェクトはクライアント要求によって削除することも、自動で削除することもできます。StorageGRID は、 S3 バケットライフサイクルと ILM の配置手順よりも優先される S3 オブジェクトロックの設定をクライアントの削除要求よりも常に優先します。

* * S3 オブジェクトのロック * ：グリッドでグローバルな S3 オブジェクトのロック設定が有効になっている場合、 S3 クライアントは S3 オブジェクトのロックを有効にしたバケットを作成し、 S3 REST API を使用して、そのバケットに追加された各オブジェクトバージョンの最新の保持設定とリーガルホールド設定を指定できます。
+
** リーガルホールドの対象になっているオブジェクトバージョンは、どの方法でも削除できません。
** オブジェクトバージョンの retain-until - date に到達するまでは、どのメソッドでもそのバージョンを削除することはできません。
** S3 オブジェクトロックが有効になっているバケット内のオブジェクトは、 ILM によって「無期限」に保持されます。ただし、それまでの保持期間が終了したあとは、クライアント要求やバケットライフサイクルの終了によってオブジェクトバージョンを削除できます。
** S3 クライアントがバケットにデフォルトの retain-date を適用する場合、オブジェクトごとに retain-date を指定する必要はありません。


* * クライアントの削除要求 * ： S3 または Swift クライアントは、オブジェクトの削除要求を問題 できます。クライアントがオブジェクトを削除すると、そのオブジェクトのすべてのコピーが StorageGRID システムから削除されます。
* * S3 バケットライフサイクル * ： S3 クライアントは、 Expiration アクションを指定するライフサイクル設定をバケットに追加できます。バケットライフサイクルが設定されている場合、クライアントが先にオブジェクトを削除しないかぎり、 Expiration アクションで指定された日付または日数が経過した時点で、 StorageGRID はオブジェクトのすべてのコピーを自動的に削除します。
* * ILM の配置手順 * ：バケットで S3 オブジェクトロックが有効になっておらず、バケットライフサイクルがない場合、 StorageGRID は ILM ルールの最後の期間が終了してオブジェクトにそれ以降の配置が指定されていないときにオブジェクトを自動的に削除します。
+

NOTE: S3 バケットライフサイクルの Expiration アクションは、常に ILM 設定よりも優先されます。その結果、 ILM のオブジェクト配置手順がすべて終了したあとも、オブジェクトがグリッドに保持されることがあります。





== クライアント削除のデータフロー

image::../media/delete_data_flow.png[クライアントによる削除のデータフロー]

. LDR サービスがクライアントアプリケーションから削除要求を受信
. LDR サービスが、メタデータストアを更新してオブジェクトをクライアント要求に対して見かけ上削除し、 ILM エンジンにオブジェクトデータのすべてのコピーの削除を指示します。
. オブジェクトがシステムから削除されます。メタデータストアが更新されてオブジェクトメタデータが削除されます。




== ILM による削除のデータフローを示します

image::../media/automatic_deletion_data_flow.png[自動削除のデータフロー]

. オブジェクトの削除が必要であることを ILM エンジンが確認します。
. ILM エンジンがメタデータストアに通知します。メタデータストアがオブジェクトメタデータを更新して、オブジェクトをクライアント要求に対して見かけ上削除します。
. ILM エンジンがオブジェクトのすべてのコピーを削除します。メタデータストアが更新されてオブジェクトメタデータが削除されます。


---
permalink: ilm/example-6-changing-ilm-policy.html 
sidebar: sidebar 
keywords: change ILM policy, example ILM policy, information lifecycle policy example 
summary: データ保護のニーズが変わった場合や新しいサイトを追加した場合は、新しい ILM ポリシーの作成とアクティブ化が必要になることがあります。 
---
= 例 6 ： ILM ポリシーを変更する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
データ保護のニーズが変わった場合や新しいサイトを追加した場合は、新しい ILM ポリシーの作成とアクティブ化が必要になることがあります。

ポリシーを変更する前に、 ILM の配置変更が一時的に StorageGRID システムの全体的なパフォーマンスに及ぼす影響について理解しておく必要があります。

この例では、拡張時に新しい StorageGRID サイトが追加され、新しいサイトにデータを格納するためにアクティブな ILM ポリシーを変更する必要があります。


CAUTION: 以下の ILM ルールとポリシーは一例にすぎません。ILM ルールを設定する方法は多数あります。新しいポリシーをアクティブ化する前に、ドラフトポリシーをシミュレートして、コンテンツの損失を防ぐためにドラフトポリシーが想定どおりに機能することを確認してください。



== ILM ポリシーの変更がパフォーマンスに与える影響

新しい ILM ポリシーをアクティブ化すると、特に新しいポリシーの配置手順で多数の既存オブジェクトの新しい場所への移動が必要になった場合には、 StorageGRID システムのパフォーマンスに一時的に影響する可能性があります。


CAUTION: 新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、そのポリシーを使用して、既存のオブジェクトと新たに取り込まれたオブジェクトを含むすべてのオブジェクトを管理します。新しい ILM ポリシーをアクティブ化する前に、既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認してください。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。

StorageGRID のパフォーマンスに一時的に影響する可能性がある ILM ポリシーの変更には、次のようなものがあります。

* 既存のイレイジャーコーディングオブジェクトへの別のイレイジャーコーディングプロファイルの適用
+

NOTE: StorageGRID では、各イレイジャーコーディングプロファイルは一意とみなされ、新しいプロファイルを使用する場合はイレイジャーコーディングフラグメントが再利用されません。

* 既存のオブジェクトに必要なコピーのタイプを変更する。たとえば、大部分のレプリケートオブジェクトをイレイジャーコーディングオブジェクトに変換する場合などです。
* 既存のオブジェクトのコピーをまったく別の場所に移動する。たとえば、クラウドストレージプールとリモートサイトの間で多数のオブジェクトを移動する場合などです。


.関連情報
xref:creating-ilm-policy.adoc[ILM ポリシーを作成する]



== 例 6 のアクティブな ILM ポリシー： 2 つのサイトでのデータ保護

この例では、アクティブな ILM ポリシーは最初に 2 サイトの StorageGRID システム用に設計され、 2 つの ILM ルールを使用しています。

image::../media/policy_6_active_policy.png[例： ILM ポリシー 6 アクティブポリシー]

この ILM ポリシーでは、テナント A に属するオブジェクトが 1 つのサイトで 2+1 のイレイジャーコーディングによって保護され、一方他のすべてのテナントに属するオブジェクトは 2-copy レプリケーションを使用して 2 つのサイト間で保護されます。


NOTE: この例の最初のルールでは、高度なフィルタを使用して、イレイジャーコーディングが小さいオブジェクトには使用されないようにしています。1MB 未満のテナント A のオブジェクトは、レプリケーションを使用する 2 つ目のルールによって保護されます。



=== ルール 1 ：テナント A に 1 つのサイトのイレイジャーコーディング

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
テナント A の 1 サイトのイレイジャーコーディング



 a| 
テナントアカウント
 a| 
テナント A



 a| 
ストレージプール
 a| 
データセンター 1



 a| 
コンテンツ配置
 a| 
データセンター 1 の 2+1 イレイジャーコーディングを 0 日目から無期限に実行

|===


=== ルール 2 ：他のテナントに 2 つのサイトをレプリケートする

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
他のテナント用の 2 サイトレプリケーション



 a| 
テナントアカウント
 a| 
無視します



 a| 
ストレージプール
 a| 
データセンター 1 とデータセンター 2



 a| 
コンテンツ配置
 a| 
0 日目から無期限にレプリケートされたコピー × 2 ：データセンター 1 に 1 つ、データセンター 2 に 1 つ。

|===


== 例 6 の ILM ポリシーとして、 3 つのサイトのデータ保護が提案されています

この例では、 3 サイトの StorageGRID システムの ILM ポリシーを更新しています。

新しいサイトを追加するための拡張を行ったあと、グリッド管理者は 2 つの新しいストレージプールを作成しました。 1 つは Data Center 3 用のストレージプール、もう 1 つは 3 つのサイトすべてを含むストレージプール（「すべてのストレージノードのデフォルトのストレージプールとは異なる」）です。その後、管理者は 2 つの新しい ILM ルールと、 3 つのサイトすべてのデータを保護するために作成された新しいドラフトの ILM ポリシーを作成しました。

image::../media/policy_6_proposed_policy.png[ILM ポリシーの例 6 ドラフトポリシー]

この新しい ILM ポリシーがアクティブ化されると、テナント A に属するオブジェクトが 3 つのサイトで 2+1 イレイジャーコーディングによって保護され、他のテナント（およびテナント A に属する小さいオブジェクト）に属するオブジェクトは 3 つのサイト間で 3 コピーレプリケーションによって保護されるようになります。



=== ルール 1 ：テナント A に 3 サイトイレイジャーコーディング

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
テナント A の 3 サイトイレイジャーコーディング



 a| 
テナントアカウント
 a| 
テナント A



 a| 
ストレージプール
 a| 
3 つのデータセンターすべて（データセンター 1 、データセンター 2 、データセンター 3 を含む）



 a| 
コンテンツ配置
 a| 
0 日目から無期限に 3 つのデータセンターすべてに 2+1 のイレイジャーコーディングを実行

|===


=== ルール 2 ：他のテナントに 3 つのサイトをレプリケーションする

[cols="1a,2a"]
|===
| ルール定義 | 値の例 


 a| 
ルール名
 a| 
他のテナント用に 3 つのサイトにレプリケーション



 a| 
テナントアカウント
 a| 
無視します



 a| 
ストレージプール
 a| 
データセンター 1 、データセンター 2 、データセンター 3



 a| 
コンテンツ配置
 a| 
0 日目から無期限にレプリケートされたコピー 3 つ：データセンター 1 に 1 つ、データセンター 2 に 1 つ、データセンター 3 に 1 つ、

|===


== 例 6 のドラフト ILM ポリシーをアクティブ化しています

新しいドラフト ILM ポリシーをアクティブ化すると、既存のオブジェクトが新しい場所に移動されたり、新規または更新されたルールの配置手順に基づいて既存のオブジェクトの新しいオブジェクトコピーが作成されたりする可能性があります。


CAUTION: 原因 ポリシーにエラーがあると、回復不能なデータ損失が発生する可能性があります。ポリシーをアクティブ化する前によく確認およびシミュレートし、想定どおりに機能することを確認してください。


CAUTION: 新しい ILM ポリシーをアクティブ化すると、 StorageGRID は、そのポリシーを使用して、既存のオブジェクトと新たに取り込まれたオブジェクトを含むすべてのオブジェクトを管理します。新しい ILM ポリシーをアクティブ化する前に、既存のレプリケートオブジェクトとイレイジャーコーディングオブジェクトの配置に対する変更を確認してください。既存のオブジェクトの場所を変更すると、新しい配置が評価されて実装される際に一時的なリソースの問題が発生する可能性があります。



=== イレイジャーコーディングの手順が変わったときの動作

この例の現在アクティブな ILM ポリシーでは、テナント A に属するオブジェクトがデータセンター 1 で 2+1 のイレイジャーコーディングを使用して保護されます。新しいドラフトの ILM ポリシーでは、テナント A に属するオブジェクトがデータセンター 1 、 2 、 3 で 2+1 イレイジャーコーディングを使用して保護されます。

新しい ILM ポリシーがアクティブ化されると、次の ILM 処理が実行されます。

* テナント A で取り込まれた新しいオブジェクトは 2 つのデータフラグメントに分割され、 1 つのパリティフラグメントが追加される。その後、 3 つのフラグメントそれぞれが別々のデータセンターに格納されます。
* テナント A に属する既存のオブジェクトは、実行中の ILM スキャンプロセスで再評価されます。ILM の配置手順では新しいイレイジャーコーディングプロファイルが使用されるため、完全に新しいイレイジャーコーディングされたフラグメントが作成され、 3 つのデータセンターに分散されます。
+

NOTE: データセンター 1 の既存の 2+1 フラグメントは再利用されません。StorageGRID では、各イレイジャーコーディングプロファイルは一意とみなされ、新しいプロファイルを使用する場合はイレイジャーコーディングフラグメントが再利用されません。





=== レプリケーション手順が変わったときの動作

この例の現在アクティブな ILM ポリシーでは、他のテナントに属するオブジェクトは、データセンター 1 と 2 のストレージプール内の 2 つのレプリケートコピーを使用して保護されます。新しいドラフトの ILM ポリシーでは、他のテナントに属するオブジェクトが、データセンター 1 、 2 、 3 のストレージプール内の 3 つのレプリケートコピーを使用して保護されます。

新しい ILM ポリシーがアクティブ化されると、次の ILM 処理が実行されます。

* テナント A 以外のテナントに新しいオブジェクトが追加されると、 StorageGRID は 3 つのコピーを作成し、各データセンターに 1 つずつコピーを保存します。
* それらの他のテナントに属する既存のオブジェクトは、 ILM のスキャンプロセスの実行中に再評価されます。データセンター 1 とデータセンター 2 にある既存のオブジェクトコピーが新しい ILM ルールのレプリケーション要件を引き続き満たしているため、 StorageGRID はデータセンター 3 にオブジェクトの新しいコピーを 1 つ作成するだけで済みます。




=== このポリシーをアクティブ化した場合のパフォーマンスへの影響

この例でドラフトの ILM ポリシーをアクティブ化すると、この StorageGRID システムの全体的なパフォーマンスに一時的に影響します。テナント A の既存オブジェクト用に新しいイレイジャーコーディングフラグメントを作成し、他のテナントの既存オブジェクト用にデータセンター 3 に新しいレプリケートコピーを作成するには、通常よりも高いレベルのグリッドリソースが必要になります。

ILM ポリシーが変更されたため、クライアントの読み取り要求と書き込み要求が一時的に通常よりもレイテンシが高くなる可能性があります。配置手順がグリッド全体に完全に実装されたあと、レイテンシは通常レベルに戻ります。

新しい ILM ポリシーをアクティブ化する際のリソースの問題を回避するには、既存のオブジェクトの数が多い場合にルールで取り込み時間の高度なフィルタを使用します。既存のオブジェクトが不必要に移動されないようにするために、新しいポリシーが適用されるおおよその時間よりも長くなるように取り込み時間を設定します。


NOTE: ILM ポリシーの変更後にオブジェクトが処理される速度を遅くしたり、上げたりする必要がある場合は、テクニカルサポートにお問い合わせください。

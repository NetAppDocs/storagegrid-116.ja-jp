---
permalink: expand/performing-expansion.html 
sidebar: sidebar 
keywords: expand, expansion procedure 
summary: 拡張を行うと、新しいグリッドノードが既存の StorageGRID 環境に追加されます。 
---
= 拡張を実行
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
拡張を行うと、新しいグリッドノードが既存の StorageGRID 環境に追加されます。

.必要なもの
* を使用して Grid Manager にサインインします xref:../admin/web-browser-requirements.adoc[サポートされている Web ブラウザ]。
* Maintenance または Root アクセス権限が必要です。
* プロビジョニングパスフレーズを用意します。
* この拡張で追加するすべてのグリッドノードの導入が完了している。
* ストレージノードを追加する場合は、リカバリの一環として実行されるデータ修復処理がすべて完了したことを確認しておきます。を参照してください xref:../maintain/checking-data-repair-jobs.adoc[データ修復ジョブを確認します]。
* 新しいサイトを追加する場合は、拡張手順 を開始する前に ILM ルールを確認して更新し、拡張が完了するまでオブジェクトコピーが新しいサイトに格納されないようにする必要があります。たとえば、デフォルトのストレージプール（すべてのストレージノード）を使用するルールの場合は、既存のストレージノードのみを含む新しいストレージプールを作成し、その新しいストレージプールを使用するように ILM ルールを更新する必要があります。そうしないと、そのサイトの最初のノードがアクティブになるとすぐに新しいサイトにオブジェクトがコピーされます。の手順を参照してください xref:../ilm/index.adoc[ILM によるオブジェクトの管理]。


.このタスクについて
拡張は次のフェーズで行います。

. 拡張を設定するには、新しいグリッドノードと新しいサイトのどちらを追加するかを指定し、追加するグリッドノードを承認します。
. 拡張を開始します。
. 拡張プロセスの実行中に、新しいリカバリパッケージファイルをダウンロードします。
. グリッド設定のステージのステータスを監視します。ステージは自動的に実行されます。各ステージは、追加するグリッドノードのタイプおよび新しいサイトが追加されるかどうかによって異なります。
+

IMPORTANT: 大規模なグリッドにおいては、一部の段階でかなりの時間がかかることがあります。たとえば、新しいストレージノードへの Cassandra のストリーミングは、 Cassandra データベースが空の場合は数分程度で完了します。ただし、 Cassandra データベースに大量のオブジェクトメタデータが含まれている場合は、数時間以上かかることがあります。「 Cassandra クラスタの拡張」ステージまたは「 Cassandra とストリーミングデータの開始」ステージのいずれかの段階では、ストレージノードをリブートしないでください。



.手順
. [* maintenance * （メンテナンス） ] > [* Tasks * （タスク * ） ] > [* Expansion * （拡張） ]
+
Grid Expansion ページが表示されます。Pending Nodes セクションには、追加する準備ができているすべてのノードが表示されます。

+
image::../media/grid_expansion_page.png[グリッドの拡張ページを示すスクリーンショット]

. [ 拡張の構成 ] を選択します。
+
[ サイトの選択 ] ダイアログボックスが表示されます。

+
image::../media/configure_expansion_dialog.gif[[ サイトの選択 ] ダイアログ]

. 開始する拡張のタイプを選択します。
+
** 新しいサイトを追加する場合は、「 * 新規」を選択し、新しいサイトの名前を入力します。
** 既存のサイトにグリッドノードを追加する場合は、「 * existing * 」を選択します。


. [ 保存（ Save ） ] を選択します。
. 「 * Pending Nodes * 」のリストを確認し、導入したすべてのグリッドノードが表示されていることを確認します。
+
必要に応じて、ノードの * グリッドネットワークの MAC アドレス * にカーソルを合わせると、そのノードに関する詳細を確認できます。

+
image::../media/grid_node_details.gif[Grid ノードの詳細のスクリーンショット]

+

NOTE: 見つからないグリッドノードがある場合は、正常に導入されたことを確認します。

. 保留中のノードのリストで、この拡張用のグリッドノードを承認します。
+
.. 承認する最初の保留中のグリッドノードの横にあるラジオボタンを選択します。
.. [* 承認（ Approve ） ] を選択し
+
グリッドノードの設定フォームが表示されます。

+
image::../media/grid_node_configuration.gif[Grid Node Configuration フォームの略]

.. 必要に応じて、一般設定を変更します。
+
*** * サイト * ：グリッドノードが関連付けられるサイトの名前。複数のノードを追加する場合は、各ノードに適したサイトを選択してください。新しいサイトを追加する場合は、すべてのノードが新しいサイトに追加されます。
*** * 名前 * ：ノードに割り当てられるホスト名と Grid Manager に表示される名前。
*** * NTP Role * ：グリッドノードのネットワークタイムプロトコル（ NTP ）ロール。オプションは * Automatic * 、 * Primary * 、 * Client * です。「 * 自動」を選択すると、管理ノード、 ADC サービスを採用するストレージノード、ゲートウェイノード、および静的な IP アドレスでないグリッドノードにプライマリロールが割り当てられます。他のすべてのグリッドノードにはクライアントロールが割り当てられます。
+

NOTE: Primary NTP ロールは、各サイトで少なくとも 2 つのノードに割り当ててください。これにより、外部タイミングソースへのシステムアクセスが冗長化されます。

*** * ADC Service * （ストレージノードのみ）：このストレージノードで Administrative Domain Controller （ ADC ）サービスを実行するかどうかを指定します。ADC サービスは、グリッドサービスの場所と可用性を追跡します。各サイトで少なくとも 3 つのストレージノードに ADC サービスが含まれている必要があります。導入後のノードに ADC サービスを追加することはできません。
+
**** このノードを追加してストレージノードを交換する場合は、交換するノードに ADC サービスが含まれている場合は「 * Yes 」を選択します。残りの ADC サービスの数が少なすぎるとストレージノードの運用を停止できないため、古いサービスが削除される前に新しい ADC サービスが利用可能になります。
**** それ以外の場合は、 * Automatic * を選択して、このノードに ADC サービスが必要かどうかをシステムに確認させます。ADC クォーラムに関する情報を確認します xref:../maintain/understanding-adc-service-quorum.adoc[こちらをご覧ください]。




.. 必要に応じて、グリッドネットワーク、管理ネットワーク、およびクライアントネットワークの設定を変更します。
+
*** * IPv4 Address （ CIDR ） * ：ネットワークインターフェイスの CIDR ネットワークアドレス。たとえば、 172.16.10.100/24 のようになります
*** * Gateway * ：グリッドノードのデフォルトゲートウェイ。たとえば、 172.16.10.1 と入力します
*** * Subnets （ CIDR ） * ：管理ネットワーク用の 1 つ以上のサブネットワーク。


.. [ 保存（ Save ） ] を選択します。
+
承認済みグリッドノードが [ 承認済みノード ] リストに移動します。

+
image::../media/grid_expansion_approved_nodes.png[承認済みノードを示すスクリーンショット]

+
*** 承認済みグリッドノードのプロパティを変更するには、そのラジオボタンを選択し、 * 編集 * を選択します。
*** 承認済みのグリッドノードを保留中のノードのリストに戻すには、該当するオプションボタンを選択し、 * リセット * を選択します。
*** 承認済みのグリッドノードを完全に削除するには、ノードの電源をオフにします。次に、そのラジオボタンを選択し、 * 削除 * を選択します。


.. 承認する保留中のグリッドノードごとに、上記の手順を繰り返します。
+

NOTE: 可能であれば、保留中のグリッドノードをすべて承認し、 1 回の拡張を実施してください。小規模な拡張を複数回実施すると、さらに時間がかかります。



. すべてのグリッドノードを承認したら、「 * プロビジョニングパスフレーズ」と入力し、「 * 拡張」を選択します。
+
数分後にページが更新され、拡張手順 のステータスが表示されます。個々のグリッドノードに影響するタスクが実行中の場合は、グリッドノードのステータスセクションに各グリッドノードの現在のステータスが表示されます。

+

NOTE: アプライアンスの場合、インストールがステージ 3 からステージ 4 、 Finalize Installation に移行していることを示す StorageGRID アプライアンスインストーラの処理が実行されます。ステージ 4 が完了すると、コントローラがリブートします。

+
image::../media/grid_expansion_progress.png[この図には説明が付随しています。]

+

NOTE: サイトの拡張には、新しいサイト用の Cassandra を設定するための追加タスクが含まれます。

. [Download Recovery Package* ] リンクが表示されたら、すぐにリカバリパッケージファイルをダウンロードします。
+
StorageGRID システムでグリッドトポロジを変更した場合は、できるだけ早くリカバリパッケージファイルの最新コピーをダウンロードする必要があります。リカバリパッケージファイルは、障害が発生した場合にシステムをリストアするために使用します。

+
.. ダウンロードリンクを選択します。
.. プロビジョニングパスフレーズを入力し、 * ダウンロードの開始 * を選択します。
.. ダウンロードが完了したら、「 .zip 」ファイルを開き、「 gpt-backup 」ディレクトリと「 _sSAID 」ファイルが含まれていることを確認します。次に '_SAID .zip ファイルを抽出し '`/GID *_REV *` ディレクトリに移動して 'passwords.txt ファイルを開くことができることを確認します
.. ダウンロードしたリカバリパッケージファイル（ .zip ）を、 2 箇所の安全な場所にコピーします。
+

IMPORTANT: リカバリパッケージファイルには StorageGRID システムからデータを取得するための暗号キーとパスワードが含まれているため、安全に保管する必要があります。



. 既存のサイトへのストレージノードの追加または新しいサイトの追加の手順に従います。


[role="tabbed-block"]
====
.既存のサイトにストレージノードを追加
--
既存のサイトにストレージノードを追加する場合は、ステータスメッセージに表示される割合を確認して、「 Starting Cassandra and streaming data 」ステージの進捗状況を監視します。

image::../media/grid_expansion_starting_cassandra.png[Grid Expansion > Cassandra およびストリーミングデータを開始しています]

この割合は、使用可能な Cassandra データの合計量と、新しいノードに書き込み済みの量に基づいて、 Cassandra のストリーミング処理の進捗状況から概算したものです。


IMPORTANT: 「 Cassandra クラスタの拡張」ステージまたは「 Cassandra とストリーミングデータの開始」ステージのいずれかの段階では、ストレージノードをリブートしないでください。特に既存のストレージノードに大量のオブジェクトメタデータが含まれている場合、これらのステージは新しいストレージノードごとに完了するまでに数時間かかることがあります。

--
.新しいサイトを追加します
--
新しいサイトを追加する場合は、 nodetool status を使用して Cassandra ストリーミングの進捗状況を監視し、「 Cassandra クラスタの拡張」ステージで新しいサイトにコピーされたメタデータの量を確認します。新しいサイトの総データ負荷は、現在のサイトの合計の約 20% 以内である必要があります。


IMPORTANT: 「 Cassandra クラスタの拡張」ステージまたは「 Cassandra とストリーミングデータの開始」ステージのいずれかの段階では、ストレージノードをリブートしないでください。特に既存のストレージノードに大量のオブジェクトメタデータが含まれている場合、これらのステージは新しいストレージノードごとに完了するまでに数時間かかることがあります。

--
====
. すべてのタスクが完了し、 * 拡張の設定 * ボタンが再表示されるまで、拡張の監視を続けます。


.完了後
追加したグリッドノードのタイプに応じて、統合と設定のための追加の手順を実行する必要があります。を参照してください xref:configuring-expanded-storagegrid-system.adoc[拡張後の設定手順]。
